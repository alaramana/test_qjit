(function(e){function t(e){var t=e.originalEvent.changedTouches,n=t[0],r="";switch(e.type){case"touchmove":r="mousemove";break;case"touchend":r="mouseup";break;default:return}var i=document.createEvent("MouseEvent");i.initMouseEvent(r,true,true,window,1,n.screenX,n.screenY,n.clientX,n.clientY,false,false,false,false,0,null);n.target.dispatchEvent(i);e.preventDefault()}e.fn.rateit=function(n,r){var i={};var s="init";var o=function(e){return e.charAt(0).toUpperCase()+e.substr(1)};if(this.length==0)return this;var u=e.type(n);if(u=="object"||n===undefined||n==null){i=e.extend({},e.fn.rateit.defaults,n)}else if(u=="string"&&r===undefined){return this.data("rateit"+o(n))}else if(u=="string"){s="setvalue"}return this.each(function(){var u=e(this);var a=function(e,t){arguments[0]="rateit"+o(e);return u.data.apply(u,arguments)};if(!u.hasClass("rateit"))u.addClass("rateit");var f=u.css("direction")!="rtl";if(s=="setvalue"){if(!a("init"))throw"Can't set value before init";if(n=="readonly"&&!a("readonly")){u.find(".rateit-range").unbind();a("wired",false)}if(n=="value"&&r==null)r=a("min");if(a("backingfld")){var l=e(a("backingfld"));if(n=="value")l.val(r);if(n=="min"&&l[0].min)l[0].min=r;if(n=="max"&&l[0].max)l[0].max=r;if(n=="step"&&l[0].step)l[0].step=r}a(n,r)}if(!a("init")){a("min",a("min")||i.min);a("max",a("max")||i.max);a("step",a("step")||i.step);a("readonly",a("readonly")!==undefined?a("readonly"):i.readonly);a("resetable",a("resetable")!==undefined?a("resetable"):i.resetable);a("backingfld",a("backingfld")||i.backingfld);a("starwidth",a("starwidth")||i.starwidth);a("starheight",a("starheight")||i.starheight);a("value",a("value")||i.value||i.min);a("ispreset",a("ispreset")!==undefined?a("ispreset"):i.ispreset);if(a("backingfld")){var l=e(a("backingfld"));a("value",l.hide().val());if(l.attr("disabled")||l.attr("readonly"))a("readonly",true);if(l[0].nodeName=="INPUT"){if(l[0].type=="range"||l[0].type=="text"){a("min",parseInt(l.attr("min"))||a("min"));a("max",parseInt(l.attr("max"))||a("max"));a("step",parseInt(l.attr("step"))||a("step"))}}if(l[0].nodeName=="SELECT"&&l[0].options.length>1){a("min",Number(l[0].options[0].value));a("max",Number(l[0].options[l[0].length-1].value));a("step",Number(l[0].options[1].value)-Number(l[0].options[0].value))}}u.append('<div class="rateit-reset"></div><div class="rateit-range"><div class="rateit-selected" style="height:'+a("starheight")+'px"></div><div class="rateit-hover" style="height:'+a("starheight")+'px"></div></div>');if(!f){u.find(".rateit-reset").css("float","right");u.find(".rateit-selected").addClass("rateit-selected-rtl");u.find(".rateit-hover").addClass("rateit-hover-rtl")}a("init",true)}var c=u.find(".rateit-range");c.width(a("starwidth")*(a("max")-a("min"))).height(a("starheight"));var h="rateit-preset"+(f?"":"-rtl");if(a("ispreset"))u.find(".rateit-selected").addClass(h);else u.find(".rateit-selected").removeClass(h);if(a("value")!=null){var p=(a("value")-a("min"))*a("starwidth");u.find(".rateit-selected").width(p)}var d=u.find(".rateit-reset");if(d.data("wired")!==true){d.click(function(){a("value",a("min"));c.find(".rateit-hover").hide().width(0);c.find(".rateit-selected").width(0).show();if(a("backingfld"))e(a("backingfld")).val(a("min"));u.trigger("reset")}).data("wired",true)}var v=function(t,n){var r=n.changedTouches?n.changedTouches[0].pageX:n.pageX;var i=r-e(t).offset().left;if(!f)i=c.width()-i;if(i>c.width())i=c.width();if(i<0)i=0;return p=Math.ceil(i/a("starwidth")*(1/a("step")))};if(!a("readonly")){if(!a("resetable"))d.hide();if(!a("wired")){c.bind("touchmove touchend",t);c.mousemove(function(e){var t=v(this,e);var n=t*a("starwidth")*a("step");var r=c.find(".rateit-hover");if(r.data("width")!=n){c.find(".rateit-selected").hide();r.width(n).show().data("width",n);var i=[t*a("step")+a("min")];u.trigger("hover",i).trigger("over",i)}});c.mouseleave(function(e){c.find(".rateit-hover").hide().width(0).data("width","");u.trigger("hover",[null]).trigger("over",[null]);c.find(".rateit-selected").show()});c.mouseup(function(t){var n=v(this,t);var r=n*a("step")+a("min");a("value",r);if(a("backingfld")){e(a("backingfld")).val(r)}if(a("ispreset")){c.find(".rateit-selected").removeClass(h);a("ispreset",false)}c.find(".rateit-hover").hide();c.find(".rateit-selected").width(n*a("starwidth")*a("step")).show();u.trigger("hover",[null]).trigger("over",[null]).trigger("rated",[r])});a("wired",true)}if(a("resetable")){d.show()}}else{d.hide()}})};e.fn.rateit.defaults={min:0,max:5,step:1,starwidth:16,starheight:14,readonly:false,resetable:true,ispreset:true};e(function(){e("div.rateit").rateit()})})(jQuery)